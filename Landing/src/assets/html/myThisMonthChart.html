<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>지난 달 vs 이번 달 (누적)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
  <style>
    .chart-container {
      margin: auto;   /* 정책: margin만 */
      width: 600px;   /* 모든 차트 동일 */
      height: 400px;  /* 모든 차트 동일 */
    }
  </style>
</head>
<body>
  <div class="chart-container">
    <canvas id="spendChart" role="img" width="600" height="400" aria-label="지난 달 대비 이번 달 누적 소비 그래프"></canvas>
  </div>

  <script>
    // 공통 X축 (1~31일)
    const labels = Array.from({ length: 31 }, (_, i) => {
      const d = (i + 1).toString().padStart(2, "0");
      return `01.${d}`;
    });

    // 지난 달(회색) 누적 값 예시 (단위: 만원)
    const lastMonth = [
      8, 15, 28, 38, 40, 55, 60, 68, 72, 75,
      82, 90, 95, 100, 98, 102, 108, 112, 116, 120,
      124, 126, 128, 130, 132, 135, 138, 140, 150, 160,
      168
    ];

    // 이번 달(초록) 누적 값 예시 — 중간까지만 값, 이후 null
    const thisMonthRaw = [
      0, 2, 10, 22, 30, 33, 48, 52, 60, 65,
      78, 90, 96, 100, 104, 110, 114, 118, 120, 122,
      124, 126, 110
    ];
    const thisMonth = labels.map((_, i) => (i < thisMonthRaw.length ? thisMonthRaw[i] : null));

    // 오늘선 위치 (예: 23일)
    const todayIndex = 22;

    const ctx = document.getElementById("spendChart").getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
            {
              label: "이번 달",
              data: thisMonth,
              borderColor: "rgb(0,170,120)",
              backgroundColor: "rgba(0,170,120,0.2)",
              borderWidth: 4,
              pointRadius: 0,
              tension: 0.25,
              spanGaps: true,
              fill: false
            },
          {
            label: "지난 달",
            data: lastMonth,
            borderColor: "rgb(200,200,200)",
            backgroundColor: "rgba(200,200,200,0.2)",
            borderWidth: 4,
            pointRadius: 0,
            tension: 0.25,
            spanGaps: true,
            fill: false
          },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: {
            display: true,
            position: "top-right",
            labels: {  boxWidth: 18, boxHeight: 8 }
          },
          tooltip: {
            callbacks: {
              label: (ctx) => (ctx.parsed.y != null ? `${ctx.dataset.label}: ${ctx.parsed.y}만원` : null)
            }
          },
          annotation: {
            annotations: {
              todayLine: {
                type: "line",
                xMin: labels[todayIndex],
                xMax: labels[todayIndex],
                borderColor: "rgba(0,0,0,0.25)",
                borderWidth: 1.5,
                borderDash: [6, 6]
              }
            }
          }
        },
        scales: {
          x: {
            grid: { color: "rgba(0,0,0,0.05)" , display: false},
            ticks: {
              callback: (value, index) =>
                (index === 0 || index === labels.length - 1 ? labels[index] : "")
            }
          },
          y: {
            title: { display: true, text: "(만원)"},
            grid: { color: "rgba(0,0,0,0.05)" },
            suggestedMin: 0,
            suggestedMax: 180,
            ticks: { stepSize: 40, callback: (v) => v }
          }
        }
      }
    });
  </script>
</body>
</html>
