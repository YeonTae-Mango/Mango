import random
import json
import csv
from datetime import datetime, timedelta
from dataclasses import dataclass
from typing import List, Dict, Tuple, Optional
import uuid
import numpy as np
import os

@dataclass
class PaymentData:
    유저아이디: int
    결제시점: str
    대분류: str
    소분류: str
    결제번호: str
    결제금액: int

@dataclass
class UserProfile:
    age: int        # 실제 나이
    gender: str     # "남자", "여자"

class GenderBasedPaymentGenerator:
    def __init__(self):
        self.used_payment_ids = set()  # 사용된 결제번호 추적
        # 기본 카테고리 정의 (ERD와 매핑)
        self.base_categories = {
            "음식": {
                "한식": {"min": 8000, "max": 25000, "avg": 15000},
                "양식": {"min": 15000, "max": 45000, "avg": 25000},
                "일식": {"min": 12000, "max": 35000, "avg": 20000},
                "중식": {"min": 8000, "max": 20000, "avg": 12000},
                "베이커리": {"min": 3000, "max": 15000, "avg": 8000},
                "카페/디저트": {"min": 4000, "max": 12000, "avg": 6500},
                "편의점": {"min": 1000, "max": 15000, "avg": 4500},
                "배달음식": {"min": 12000, "max": 35000, "avg": 18000}
            },
            "소매/유통": {
                "의복/의류": {"min": 20000, "max": 200000, "avg": 80000},
                "화장품소매": {"min": 10000, "max": 150000, "avg": 45000},
                "패션잡화": {"min": 15000, "max": 100000, "avg": 40000},
                "인테리어/가정용품": {"min": 10000, "max": 80000, "avg": 30000},
                "인터넷쇼핑": {"min": 8000, "max": 120000, "avg": 35000},
                "스포츠/레져용품": {"min": 20000, "max": 300000, "avg": 80000}
            },
            "생활서비스": {
                "교통서비스": {"min": 1370, "max": 30000, "avg": 8000},
                "미용서비스": {"min": 15000, "max": 150000, "avg": 50000},
                "차량관리/서비스": {"min": 30000, "max": 200000, "avg": 80000},
                "여행": {"min": 50000, "max": 1000000, "avg": 200000}
            },
            "여가/오락": {
                "일반스포츠": {"min": 60000, "max": 200000, "avg": 100000},
                "취미/오락": {"min": 10000, "max": 100000, "avg": 35000},
                "숙박": {"min": 50000, "max": 300000, "avg": 120000}
            },
            "공연/전시": {
                "공연관람": {"min": 30000, "max": 150000, "avg": 70000},
                "전시장": {"min": 10000, "max": 30000, "avg": 18000},
                "경기관람": {"min": 20000, "max": 80000, "avg": 40000}
            },
            "학문/교육": {
                "예체능계학원": {"min": 100000, "max": 500000, "avg": 250000},
                "외국어학원": {"min": 150000, "max": 600000, "avg": 300000},
                "기술/직업교육학원": {"min": 200000, "max": 800000, "avg": 400000},
                "서적/도서": {"min": 8000, "max": 40000, "avg": 18000}
            },
            "미디어/통신": {
                "인터넷쇼핑": {"min": 5000, "max": 80000, "avg": 25000},
                "기타결제": {"min": 10000, "max": 50000, "avg": 20000}
            }
        }
        
        # 남성 페르소나 20개
        self.male_personas = {
            "활동적_스포츠맨": {
                "age_range": (20, 35),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"한식": 0.3, "양식": 0.2, "중식": 0.15, "베이커리": 0.1, "카페/디저트": 0.25}},
                    "소매/유통": {"frequency": 20, "preferences": {"스포츠/레져용품": 0.5, "의복/의류": 0.25, "인터넷쇼핑": 0.1, "인테리어/가정용품": 0.05, "음/식료품소매": 0.05, "종합소매점": 0.05}},
                    "여가/오락": {"frequency": 25, "preferences": {"일반스포츠": 0.7, "취미/오락": 0.15, "숙박": 0.1, "요가/단전/마사지": 0.05}},
                    "생활서비스": {"frequency": 15, "preferences": {"교통서비스": 0.6, "차량관리/서비스": 0.25, "미용서비스": 0.1, "여행": 0.03, "유학대행": 0.01, "사우나": 0.01}},
                    "공연/전시": {"frequency": 3, "preferences": {"경기관람": 0.7, "공연관람": 0.2, "전시장": 0.1}},
                    "학문/교육": {"frequency": 2, "preferences": {"예체능계학원": 0.6, "기술/직업교육학원": 0.3, "외국어학원": 0.05, "입시학원": 0.03, "독서실": 0.02}},
                    "미디어/통신": {"frequency": 5, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 220
            },
            
            "IT_개발자": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 35, "preferences": {"카페/디저트": 0.3, "중식": 0.25, "한식": 0.2, "양식": 0.15, "일식": 0.1}},
                    "소매/유통": {"frequency": 18, "preferences": {"인터넷쇼핑": 0.4, "의복/의류": 0.25, "서적/도서": 0.15, "사무/교육용품": 0.1, "건강/기호식품": 0.05, "음/식료품소매": 0.05}},
                    "여가/오락": {"frequency": 25, "preferences": {"취미/오락": 0.8, "숙박": 0.15, "일반스포츠": 0.03, "요가/단전/마사지": 0.02}},
                    "생활서비스": {"frequency": 10, "preferences": {"교통서비스": 0.7, "미용서비스": 0.2, "차량관리/서비스": 0.05, "여행": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "미디어/통신": {"frequency": 20, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}},
                    "공연/전시": {"frequency": 2, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "학문/교육": {"frequency": 3, "preferences": {"기술/직업교육학원": 0.6, "외국어학원": 0.3, "서적/도서": 0.05, "예체능계학원": 0.03, "입시학원": 0.01, "독서실": 0.01}}
                },
                "budget_multiplier": 1.2,
                "monthly_budget": 280
            },
            
            "대학생_알바족": {
                "age_range": (19, 26),
                "categories": {
                    "음식": {"frequency": 50, "preferences": {"중식": 0.3, "카페/디저트": 0.25, "한식": 0.2, "베이커리": 0.15, "양식": 0.05, "일식": 0.05}},
                    "소매/유통": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.4, "의복/의류": 0.3, "음/식료품소매": 0.15, "서적/도서": 0.1, "건강/기호식품": 0.03, "종합소매점": 0.02}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.6, "숙박": 0.25, "일반스포츠": 0.1, "요가/단전/마사지": 0.05}},
                    "생활서비스": {"frequency": 18, "preferences": {"교통서비스": 0.8, "미용서비스": 0.15, "여행": 0.03, "차량관리/서비스": 0.01, "사우나": 0.005, "유학대행": 0.005}},
                    "학문/교육": {"frequency": 8, "preferences": {"외국어학원": 0.4, "입시학원": 0.3, "독서실": 0.15, "기술/직업교육학원": 0.1, "예체능계학원": 0.05}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "미디어/통신": {"frequency": 8, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.6,
                "monthly_budget": 120
            },
            
            "직장인_술좋아": {
                "age_range": (25, 40),
                "categories": {
                    "음식": {"frequency": 55, "preferences": {"한식": 0.4, "양식": 0.25, "일식": 0.2, "중식": 0.1, "카페/디저트": 0.05}},
                    "소매/유통": {"frequency": 12, "preferences": {"음/식료품소매": 0.35, "의복/의류": 0.25, "인터넷쇼핑": 0.2, "건강/기호식품": 0.15, "종합소매점": 0.03, "인테리어/가정용품": 0.02}},
                    "여가/오락": {"frequency": 20, "preferences": {"취미/오락": 0.5, "숙박": 0.35, "요가/단전/마사지": 0.1, "일반스포츠": 0.05}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.4, "차량관리/서비스": 0.25, "사우나": 0.15, "여행": 0.15, "미용서비스": 0.03, "휴게시설": 0.02}},
                    "공연/전시": {"frequency": 2, "preferences": {"공연관람": 0.5, "경기관람": 0.4, "전시장": 0.1}},
                    "학문/교육": {"frequency": 1, "preferences": {"기술/직업교육학원": 0.5, "외국어학원": 0.3, "예체능계학원": 0.1, "서적/도서": 0.05, "입시학원": 0.03, "독서실": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 250
            },
            
            "미니멀_절약형": {
                "age_range": (22, 35),
                "categories": {
                    "음식": {"frequency": 35, "preferences": {"중식": 0.35, "한식": 0.3, "카페/디저트": 0.2, "베이커리": 0.1, "양식": 0.03, "일식": 0.02}},
                    "소매/유통": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.5, "음/식료품소매": 0.2, "의복/의류": 0.15, "서적/도서": 0.1, "건강/기호식품": 0.03, "종합소매점": 0.02}},
                    "여가/오락": {"frequency": 10, "preferences": {"취미/오락": 0.7, "숙박": 0.2, "일반스포츠": 0.05, "요가/단전/마사지": 0.05}},
                    "생활서비스": {"frequency": 12, "preferences": {"교통서비스": 0.8, "미용서비스": 0.1, "여행": 0.05, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "학문/교육": {"frequency": 5, "preferences": {"서적/도서": 0.5, "독서실": 0.2, "외국어학원": 0.15, "기술/직업교육학원": 0.1, "예체능계학원": 0.03, "입시학원": 0.02}},
                    "공연/전시": {"frequency": 1, "preferences": {"전시장": 0.6, "공연관람": 0.3, "경기관람": 0.1}},
                    "미디어/통신": {"frequency": 10, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.7,
                "monthly_budget": 150
            },
            
            "차덕후_드라이버": {
                "age_range": (25, 45),
                "categories": {
                    "음식": {"frequency": 35, "preferences": {"한식": 0.35, "양식": 0.25, "카페/디저트": 0.2, "중식": 0.15, "일식": 0.03, "베이커리": 0.02}},
                    "소매/유통": {"frequency": 18, "preferences": {"스포츠/레져용품": 0.35, "인터넷쇼핑": 0.25, "의복/의류": 0.2, "음/식료품소매": 0.1, "악기/공예": 0.05, "건강/기호식품": 0.03, "사무/교육용품": 0.02}},
                    "생활서비스": {"frequency": 30, "preferences": {"차량관리/서비스": 0.6, "교통서비스": 0.25, "여행": 0.1, "미용서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "일반스포츠": 0.15, "요가/단전/마사지": 0.05}},
                    "공연/전시": {"frequency": 3, "preferences": {"경기관람": 0.7, "공연관람": 0.2, "전시장": 0.1}},
                    "학문/교육": {"frequency": 1, "preferences": {"기술/직업교육학원": 0.6, "외국어학원": 0.2, "예체능계학원": 0.1, "서적/도서": 0.05, "입시학원": 0.03, "독서실": 0.02}},
                    "미디어/통신": {"frequency": 5, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.3,
                "monthly_budget": 320
            },
            
            "문화_예술형": {
                "age_range": (20, 40),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"카페/디저트": 0.35, "양식": 0.25, "베이커리": 0.2, "한식": 0.15, "일식": 0.05}},
                    "공연/전시": {"frequency": 20, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "소매/유통": {"frequency": 15, "preferences": {"서적/도서": 0.3, "의복/의류": 0.25, "악기/공예": 0.2, "인터넷쇼핑": 0.15, "화장품소매": 0.05, "패션잡화": 0.03, "사무/교육용품": 0.02}},
                    "여가/오락": {"frequency": 18, "preferences": {"취미/오락": 0.6, "숙박": 0.25, "일반스포츠": 0.1, "요가/단전/마사지": 0.05}},
                    "생활서비스": {"frequency": 12, "preferences": {"교통서비스": 0.6, "미용서비스": 0.2, "여행": 0.15, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "학문/교육": {"frequency": 8, "preferences": {"예체능계학원": 0.5, "외국어학원": 0.2, "기술/직업교육학원": 0.15, "서적/도서": 0.1, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 3, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.9,
                "monthly_budget": 200
            },
            
            "헬스_마니아": {
                "age_range": (20, 35),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"한식": 0.4, "양식": 0.25, "카페/디저트": 0.15, "베이커리": 0.1, "중식": 0.05, "일식": 0.05}},
                    "여가/오락": {"frequency": 35, "preferences": {"일반스포츠": 0.7, "요가/단전/마사지": 0.15, "취미/오락": 0.1, "숙박": 0.05}},
                    "소매/유통": {"frequency": 22, "preferences": {"스포츠/레져용품": 0.5, "의복/의류": 0.2, "건강/기호식품": 0.15, "인터넷쇼핑": 0.1, "음/식료품소매": 0.03, "화장품소매": 0.02}},
                    "생활서비스": {"frequency": 15, "preferences": {"교통서비스": 0.5, "미용서비스": 0.25, "사우나": 0.15, "여행": 0.08, "차량관리/서비스": 0.01, "휴게시설": 0.01}},
                    "공연/전시": {"frequency": 2, "preferences": {"경기관람": 0.7, "공연관람": 0.2, "전시장": 0.1}},
                    "학문/교육": {"frequency": 3, "preferences": {"예체능계학원": 0.6, "기술/직업교육학원": 0.2, "외국어학원": 0.1, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 2, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 260
            },
            
            "게임_덕후": {
                "age_range": (18, 35),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"중식": 0.35, "카페/디저트": 0.25, "한식": 0.2, "베이커리": 0.15, "양식": 0.03, "일식": 0.02}},
                    "여가/오락": {"frequency": 35, "preferences": {"취미/오락": 0.9, "숙박": 0.08, "일반스포츠": 0.01, "요가/단전/마사지": 0.01}},
                    "소매/유통": {"frequency": 25, "preferences": {"인터넷쇼핑": 0.6, "의복/의류": 0.2, "음/식료품소매": 0.1, "건강/기호식품": 0.05, "서적/도서": 0.03, "사무/교육용품": 0.02}},
                    "생활서비스": {"frequency": 8, "preferences": {"교통서비스": 0.7, "미용서비스": 0.2, "여행": 0.05, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "미디어/통신": {"frequency": 25, "preferences": {"기타결제": 0.8, "인터넷쇼핑": 0.2}},
                    "공연/전시": {"frequency": 1, "preferences": {"경기관람": 0.5, "공연관람": 0.3, "전시장": 0.2}},
                    "학문/교육": {"frequency": 1, "preferences": {"기술/직업교육학원": 0.5, "서적/도서": 0.2, "외국어학원": 0.15, "예체능계학원": 0.1, "독서실": 0.03, "입시학원": 0.02}}
                },
                "budget_multiplier": 0.8,
                "monthly_budget": 180
            },
            
            "고소득_직장인": {
                "age_range": (28, 45),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"양식": 0.35, "일식": 0.3, "한식": 0.2, "카페/디저트": 0.1, "베이커리": 0.03, "중식": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"차량관리/서비스": 0.4, "여행": 0.3, "교통서비스": 0.15, "미용서비스": 0.1, "사우나": 0.03, "유학대행": 0.01, "휴게시설": 0.01}},
                    "소매/유통": {"frequency": 20, "preferences": {"의복/의류": 0.35, "인터넷쇼핑": 0.25, "인테리어/가정용품": 0.2, "스포츠/레져용품": 0.1, "패션잡화": 0.05, "음/식료품소매": 0.03, "화장품소매": 0.02}},
                    "여가/오락": {"frequency": 22, "preferences": {"숙박": 0.4, "일반스포츠": 0.3, "취미/오락": 0.25, "요가/단전/마사지": 0.05}},
                    "공연/전시": {"frequency": 10, "preferences": {"공연관람": 0.5, "경기관람": 0.4, "전시장": 0.1}},
                    "학문/교육": {"frequency": 3, "preferences": {"기술/직업교육학원": 0.4, "외국어학원": 0.35, "예체능계학원": 0.2, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 5, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.8,
                "monthly_budget": 450
            },
            
            "퇴직_중년남성": {
                "age_range": (50, 70),
                "categories": {
                    "음식": {"frequency": 50, "preferences": {"한식": 0.5, "중식": 0.2, "카페/디저트": 0.15, "양식": 0.1, "베이커리": 0.03, "일식": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.35, "사우나": 0.25, "미용서비스": 0.2, "여행": 0.15, "차량관리/서비스": 0.03, "휴게시설": 0.02}},
                    "소매/유통": {"frequency": 15, "preferences": {"음/식료품소매": 0.4, "종합소매점": 0.2, "건강/기호식품": 0.15, "의복/의류": 0.1, "인터넷쇼핑": 0.08, "인테리어/가정용품": 0.05, "서적/도서": 0.02}},
                    "여가/오락": {"frequency": 12, "preferences": {"숙박": 0.4, "취미/오락": 0.3, "요가/단전/마사지": 0.2, "일반스포츠": 0.1}},
                    "공연/전시": {"frequency": 5, "preferences": {"공연관람": 0.5, "경기관람": 0.3, "전시장": 0.2}},
                    "학문/교육": {"frequency": 2, "preferences": {"서적/도서": 0.4, "예체능계학원": 0.3, "기술/직업교육학원": 0.2, "외국어학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 3, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.8,
                "monthly_budget": 300
            },
            
            "공대생_엔지니어": {
                "age_range": (20, 28),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"중식": 0.3, "한식": 0.25, "카페/디저트": 0.2, "베이커리": 0.15, "양식": 0.05, "일식": 0.05}},
                    "소매/유통": {"frequency": 20, "preferences": {"인터넷쇼핑": 0.4, "사무/교육용품": 0.2, "서적/도서": 0.15, "의복/의류": 0.1, "스포츠/레져용품": 0.08, "건강/기호식품": 0.05, "음/식료품소매": 0.02}},
                    "여가/오락": {"frequency": 20, "preferences": {"취미/오락": 0.7, "숙박": 0.15, "일반스포츠": 0.1, "요가/단전/마사지": 0.05}},
                    "생활서비스": {"frequency": 12, "preferences": {"교통서비스": 0.7, "미용서비스": 0.15, "여행": 0.1, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "학문/교육": {"frequency": 10, "preferences": {"기술/직업교육학원": 0.5, "외국어학원": 0.2, "서적/도서": 0.15, "독서실": 0.1, "예체능계학원": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 18, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}},
                    "공연/전시": {"frequency": 2, "preferences": {"전시장": 0.4, "공연관람": 0.3, "경기관람": 0.3}}
                },
                "budget_multiplier": 0.9,
                "monthly_budget": 200
            },
            
            "아빠_직장인": {
                "age_range": (30, 50),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"한식": 0.4, "양식": 0.2, "중식": 0.15, "카페/디저트": 0.15, "일식": 0.05, "베이커리": 0.05}},
                    "소매/유통": {"frequency": 25, "preferences": {"종합소매점": 0.3, "음/식료품소매": 0.25, "인터넷쇼핑": 0.2, "의복/의류": 0.1, "인테리어/가정용품": 0.08, "스포츠/레져용품": 0.05, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.4, "차량관리/서비스": 0.3, "여행": 0.2, "미용서비스": 0.05, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 15, "preferences": {"숙박": 0.4, "취미/오락": 0.3, "일반스포츠": 0.2, "요가/단전/마사지": 0.1}},
                    "공연/전시": {"frequency": 5, "preferences": {"경기관람": 0.5, "공연관람": 0.3, "전시장": 0.2}},
                    "학문/교육": {"frequency": 8, "preferences": {"입시학원": 0.4, "외국어학원": 0.2, "예체능계학원": 0.2, "기술/직업교육학원": 0.1, "서적/도서": 0.05, "독서실": 0.05}},
                    "미디어/통신": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.2,
                "monthly_budget": 400
            },
            
            "자영업자": {
                "age_range": (25, 55),
                "categories": {
                    "음식": {"frequency": 48, "preferences": {"한식": 0.35, "중식": 0.25, "양식": 0.2, "카페/디저트": 0.15, "일식": 0.03, "베이커리": 0.02}},
                    "소매/유통": {"frequency": 15, "preferences": {"음/식료품소매": 0.3, "종합소매점": 0.2, "의복/의류": 0.15, "인터넷쇼핑": 0.15, "인테리어/가정용품": 0.1, "건강/기호식품": 0.08, "사무/교육용품": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"교통서비스": 0.4, "차량관리/서비스": 0.25, "사우나": 0.15, "여행": 0.15, "미용서비스": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 18, "preferences": {"취미/오락": 0.4, "숙박": 0.3, "요가/단전/마사지": 0.2, "일반스포츠": 0.1}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.4, "경기관람": 0.4, "전시장": 0.2}},
                    "학문/교육": {"frequency": 2, "preferences": {"기술/직업교육학원": 0.5, "외국어학원": 0.3, "서적/도서": 0.1, "예체능계학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"기타결제": 0.7, "인터넷쇼핑": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 320
            },
            
            "패션_스타일리스트": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 38, "preferences": {"카페/디저트": 0.35, "양식": 0.25, "베이커리": 0.2, "한식": 0.15, "일식": 0.03, "중식": 0.02}},
                    "소매/유통": {"frequency": 35, "preferences": {"의복/의류": 0.4, "패션잡화": 0.25, "화장품소매": 0.15, "인터넷쇼핑": 0.1, "악기/공예": 0.05, "서적/도서": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"미용서비스": 0.5, "교통서비스": 0.3, "여행": 0.15, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 8, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 3, "preferences": {"예체능계학원": 0.5, "외국어학원": 0.3, "기술/직업교육학원": 0.15, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 5, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 350
            },
            
            "음식점_사장": {
                "age_range": (30, 60),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"한식": 0.4, "양식": 0.2, "중식": 0.15, "일식": 0.15, "카페/디저트": 0.05, "베이커리": 0.05}},
                    "소매/유통": {"frequency": 20, "preferences": {"음/식료품소매": 0.5, "종합소매점": 0.2, "인터넷쇼핑": 0.15, "의복/의류": 0.08, "건강/기호식품": 0.05, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 22, "preferences": {"교통서비스": 0.4, "차량관리/서비스": 0.25, "여행": 0.2, "미용서비스": 0.1, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 12, "preferences": {"취미/오락": 0.4, "숙박": 0.35, "요가/단전/마사지": 0.15, "일반스포츠": 0.1}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "경기관람": 0.3, "전시장": 0.2}},
                    "학문/교육": {"frequency": 2, "preferences": {"기술/직업교육학원": 0.5, "서적/도서": 0.2, "외국어학원": 0.15, "예체능계학원": 0.1, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 280
            },
            
            "의료진_전문직": {
                "age_range": (26, 50),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"양식": 0.3, "한식": 0.25, "일식": 0.2, "카페/디저트": 0.15, "중식": 0.05, "베이커리": 0.05}},
                    "생활서비스": {"frequency": 22, "preferences": {"교통서비스": 0.3, "차량관리/서비스": 0.25, "여행": 0.2, "미용서비스": 0.15, "사우나": 0.05, "유학대행": 0.03, "휴게시설": 0.02}},
                    "소매/유통": {"frequency": 18, "preferences": {"의복/의류": 0.3, "인터넷쇼핑": 0.25, "건강/기호식품": 0.15, "인테리어/가정용품": 0.1, "서적/도서": 0.1, "화장품소매": 0.05, "패션잡화": 0.03, "음/식료품소매": 0.02}},
                    "여가/오락": {"frequency": 18, "preferences": {"숙박": 0.4, "요가/단전/마사지": 0.25, "일반스포츠": 0.2, "취미/오락": 0.15}},
                    "공연/전시": {"frequency": 8, "preferences": {"공연관람": 0.6, "전시장": 0.3, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 5, "preferences": {"기술/직업교육학원": 0.4, "외국어학원": 0.3, "서적/도서": 0.2, "예체능계학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.6,
                "monthly_budget": 500
            },
            
            "금융업_직장인": {
                "age_range": (25, 45),
                "categories": {
                    "음식": {"frequency": 44, "preferences": {"양식": 0.35, "한식": 0.25, "일식": 0.2, "카페/디저트": 0.15, "중식": 0.03, "베이커리": 0.02}},
                    "소매/유통": {"frequency": 20, "preferences": {"의복/의류": 0.35, "인터넷쇼핑": 0.25, "패션잡화": 0.15, "화장품소매": 0.1, "인테리어/가정용품": 0.08, "서적/도서": 0.05, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"교통서비스": 0.35, "차량관리/서비스": 0.25, "미용서비스": 0.2, "여행": 0.15, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 20, "preferences": {"숙박": 0.4, "일반스포츠": 0.3, "취미/오락": 0.2, "요가/단전/마사지": 0.1}},
                    "공연/전시": {"frequency": 8, "preferences": {"공연관람": 0.5, "경기관람": 0.3, "전시장": 0.2}},
                    "학문/교육": {"frequency": 5, "preferences": {"외국어학원": 0.4, "기술/직업교육학원": 0.3, "서적/도서": 0.2, "예체능계학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.4,
                "monthly_budget": 420
            }
        }
        
        # 여성 페르소나 20개
        self.female_personas = {
            "카페_인플루언서": {
                "age_range": (20, 35),
                "categories": {
                    "음식": {"frequency": 55, "preferences": {"카페/디저트": 0.4, "베이커리": 0.25, "양식": 0.15, "한식": 0.1, "일식": 0.05}},
                    "소매/유통": {"frequency": 25, "preferences": {"화장품소매": 0.35, "패션잡화": 0.25, "의복/의류": 0.2, "인터넷쇼핑": 0.1, "악기/공예": 0.05, "서적/도서": 0.03, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 18, "preferences": {"미용서비스": 0.5, "교통서비스": 0.35, "여행": 0.1, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.6, "숙박": 0.3, "요가/단전/마사지": 0.08, "일반스포츠": 0.02}},
                    "공연/전시": {"frequency": 5, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 2, "preferences": {"예체능계학원": 0.4, "외국어학원": 0.3, "기술/직업교육학원": 0.2, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 280
            },
            
            "뷰티_덕후": {
                "age_range": (18, 40),
                "categories": {
                    "음식": {"frequency": 38, "preferences": {"카페/디저트": 0.35, "베이커리": 0.25, "양식": 0.2, "한식": 0.15, "일식": 0.03, "중식": 0.02}},
                    "소매/유통": {"frequency": 40, "preferences": {"화장품소매": 0.5, "패션잡화": 0.2, "의복/의류": 0.15, "인터넷쇼핑": 0.1, "건강/기호식품": 0.03, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"미용서비스": 0.6, "교통서비스": 0.25, "사우나": 0.1, "여행": 0.03, "차량관리/서비스": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 12, "preferences": {"요가/단전/마사지": 0.4, "취미/오락": 0.35, "숙박": 0.2, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "학문/교육": {"frequency": 2, "preferences": {"예체능계학원": 0.5, "외국어학원": 0.3, "기술/직업교육학원": 0.15, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.2,
                "monthly_budget": 320
            },
            
            "쇼핑_러버": {
                "age_range": (20, 40),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"카페/디저트": 0.3, "양식": 0.25, "베이커리": 0.2, "한식": 0.15, "일식": 0.1}},
                    "소매/유통": {"frequency": 45, "preferences": {"의복/의류": 0.35, "화장품소매": 0.25, "패션잡화": 0.2, "인터넷쇼핑": 0.1, "인테리어/가정용품": 0.05, "악기/공예": 0.03, "스포츠/레져용품": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.4, "미용서비스": 0.35, "여행": 0.2, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 5, "preferences": {"공연관람": 0.6, "전시장": 0.3, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 1, "preferences": {"외국어학원": 0.4, "예체능계학원": 0.3, "기술/직업교육학원": 0.2, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 12, "preferences": {"인터넷쇼핑": 0.8, "기타결제": 0.2}}
                },
                "budget_multiplier": 1.4,
                "monthly_budget": 380
            },
            
            "직장인_커리어우먼": {
                "age_range": (25, 40),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"카페/디저트": 0.3, "양식": 0.25, "한식": 0.2, "일식": 0.15, "베이커리": 0.1}},
                    "소매/유통": {"frequency": 22, "preferences": {"의복/의류": 0.35, "화장품소매": 0.25, "인터넷쇼핑": 0.15, "패션잡화": 0.15, "인테리어/가정용품": 0.05, "서적/도서": 0.03, "사무/교육용품": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"교통서비스": 0.35, "미용서비스": 0.3, "차량관리/서비스": 0.2, "여행": 0.1, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 18, "preferences": {"취미/오락": 0.4, "숙박": 0.3, "요가/단전/마사지": 0.2, "일반스포츠": 0.1}},
                    "공연/전시": {"frequency": 6, "preferences": {"공연관람": 0.6, "전시장": 0.3, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 4, "preferences": {"외국어학원": 0.4, "기술/직업교육학원": 0.3, "예체능계학원": 0.2, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.3,
                "monthly_budget": 350
            },
            
            "대학생_소확행": {
                "age_range": (19, 26),
                "categories": {
                    "음식": {"frequency": 55, "preferences": {"카페/디저트": 0.4, "베이커리": 0.25, "중식": 0.15, "한식": 0.1, "양식": 0.05, "일식": 0.05}},
                    "소매/유통": {"frequency": 18, "preferences": {"화장품소매": 0.35, "의복/의류": 0.25, "인터넷쇼핑": 0.2, "음/식료품소매": 0.1, "서적/도서": 0.05, "패션잡화": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 12, "preferences": {"교통서비스": 0.7, "미용서비스": 0.25, "여행": 0.03, "차량관리/서비스": 0.01, "사우나": 0.005, "휴게시설": 0.005}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.6, "숙박": 0.25, "요가/단전/마사지": 0.1, "일반스포츠": 0.05}},
                    "학문/교육": {"frequency": 10, "preferences": {"외국어학원": 0.35, "독서실": 0.25, "입시학원": 0.2, "예체능계학원": 0.15, "기술/직업교육학원": 0.03, "서적/도서": 0.02}},
                    "공연/전시": {"frequency": 4, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "미디어/통신": {"frequency": 12, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.7,
                "monthly_budget": 150
            },
            
            "헬시_라이프": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"한식": 0.3, "카페/디저트": 0.25, "양식": 0.2, "베이커리": 0.15, "일식": 0.1}},
                    "여가/오락": {"frequency": 30, "preferences": {"일반스포츠": 0.5, "요가/단전/마사지": 0.3, "취미/오락": 0.15, "숙박": 0.05}},
                    "소매/유통": {"frequency": 20, "preferences": {"스포츠/레져용품": 0.35, "화장품소매": 0.25, "의복/의류": 0.2, "건강/기호식품": 0.1, "인터넷쇼핑": 0.08, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 18, "preferences": {"미용서비스": 0.35, "교통서비스": 0.35, "사우나": 0.15, "여행": 0.1, "요가/단전/마사지": 0.03, "차량관리/서비스": 0.01, "휴게시설": 0.01}},
                    "공연/전시": {"frequency": 2, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "학문/교육": {"frequency": 3, "preferences": {"예체능계학원": 0.5, "기술/직업교육학원": 0.2, "외국어학원": 0.15, "서적/도서": 0.1, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 5, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 270
            },
            
            "예술_감성": {
                "age_range": (20, 35),
                "categories": {
                    "음식": {"frequency": 38, "preferences": {"카페/디저트": 0.4, "베이커리": 0.25, "양식": 0.2, "한식": 0.1, "일식": 0.05}},
                    "공연/전시": {"frequency": 25, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "소매/유통": {"frequency": 18, "preferences": {"서적/도서": 0.25, "악기/공예": 0.25, "화장품소매": 0.2, "의복/의류": 0.15, "인터넷쇼핑": 0.1, "패션잡화": 0.03, "사무/교육용품": 0.02}},
                    "생활서비스": {"frequency": 15, "preferences": {"교통서비스": 0.5, "미용서비스": 0.3, "여행": 0.15, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "학문/교육": {"frequency": 12, "preferences": {"예체능계학원": 0.5, "외국어학원": 0.25, "서적/도서": 0.15, "기술/직업교육학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "여가/오락": {"frequency": 10, "preferences": {"취미/오락": 0.6, "숙박": 0.25, "요가/단전/마사지": 0.1, "일반스포츠": 0.05}},
                    "미디어/통신": {"frequency": 5, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.8,
                "monthly_budget": 200
            },
            
            "미니멀_절약형": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 32, "preferences": {"카페/디저트": 0.3, "중식": 0.25, "한식": 0.2, "베이커리": 0.15, "양식": 0.05, "일식": 0.05}},
                    "소매/유통": {"frequency": 12, "preferences": {"인터넷쇼핑": 0.4, "화장품소매": 0.25, "의복/의류": 0.2, "음/식료품소매": 0.1, "서적/도서": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 10, "preferences": {"교통서비스": 0.7, "미용서비스": 0.2, "여행": 0.05, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 8, "preferences": {"취미/오락": 0.7, "숙박": 0.2, "요가/단전/마사지": 0.08, "일반스포츠": 0.02}},
                    "학문/교육": {"frequency": 6, "preferences": {"서적/도서": 0.4, "독서실": 0.3, "외국어학원": 0.2, "기술/직업교육학원": 0.05, "예체능계학원": 0.03, "입시학원": 0.02}},
                    "공연/전시": {"frequency": 2, "preferences": {"전시장": 0.6, "공연관람": 0.3, "경기관람": 0.1}},
                    "미디어/통신": {"frequency": 12, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.6,
                "monthly_budget": 120
            },
            
            "여행_덕후": {
                "age_range": (23, 40),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"양식": 0.25, "일식": 0.2, "카페/디저트": 0.2, "한식": 0.2, "베이커리": 0.15}},
                    "생활서비스": {"frequency": 30, "preferences": {"여행": 0.4, "교통서비스": 0.3, "미용서비스": 0.15, "차량관리/서비스": 0.08, "유학대행": 0.05, "사우나": 0.01, "휴게시설": 0.01}},
                    "소매/유통": {"frequency": 18, "preferences": {"의복/의류": 0.25, "인터넷쇼핑": 0.25, "화장품소매": 0.2, "패션잡화": 0.15, "스포츠/레져용품": 0.1, "인테리어/가정용품": 0.03, "건강/기호식품": 0.02}},
                    "여가/오락": {"frequency": 25, "preferences": {"숙박": 0.5, "취미/오락": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 5, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 3, "preferences": {"외국어학원": 0.5, "예체능계학원": 0.3, "기술/직업교육학원": 0.15, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.5,
                "monthly_budget": 400
            },
            
            "고소득_전문직": {
                "age_range": (28, 45),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"양식": 0.35, "일식": 0.25, "카페/디저트": 0.2, "한식": 0.15, "베이커리": 0.05}},
                    "소매/유통": {"frequency": 30, "preferences": {"의복/의류": 0.3, "화장품소매": 0.25, "패션잡화": 0.2, "인테리어/가정용품": 0.15, "인터넷쇼핑": 0.05, "서적/도서": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 25, "preferences": {"미용서비스": 0.35, "차량관리/서비스": 0.25, "여행": 0.2, "교통서비스": 0.15, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 20, "preferences": {"숙박": 0.4, "요가/단전/마사지": 0.3, "취미/오락": 0.2, "일반스포츠": 0.1}},
                    "공연/전시": {"frequency": 12, "preferences": {"공연관람": 0.6, "전시장": 0.3, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 5, "preferences": {"외국어학원": 0.4, "기술/직업교육학원": 0.3, "예체능계학원": 0.2, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 2.0,
                "monthly_budget": 550
            },
            
            "엄마_주부": {
                "age_range": (28, 50),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"한식": 0.35, "카페/디저트": 0.25, "베이커리": 0.2, "양식": 0.15, "중식": 0.03, "일식": 0.02}},
                    "소매/유통": {"frequency": 35, "preferences": {"종합소매점": 0.3, "음/식료품소매": 0.25, "의복/의류": 0.15, "인터넷쇼핑": 0.15, "인테리어/가정용품": 0.1, "화장품소매": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.4, "미용서비스": 0.25, "차량관리/서비스": 0.2, "여행": 0.1, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 12, "preferences": {"취미/오락": 0.4, "숙박": 0.35, "요가/단전/마사지": 0.2, "일반스포츠": 0.05}},
                    "학문/교육": {"frequency": 15, "preferences": {"입시학원": 0.4, "예체능계학원": 0.25, "외국어학원": 0.2, "기술/직업교육학원": 0.1, "서적/도서": 0.03, "독서실": 0.02}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "미디어/통신": {"frequency": 12, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.1,
                "monthly_budget": 380
            },
            
            "패션_MD": {
                "age_range": (24, 38),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"카페/디저트": 0.35, "양식": 0.25, "베이커리": 0.2, "한식": 0.15, "일식": 0.05}},
                    "소매/유통": {"frequency": 50, "preferences": {"의복/의류": 0.4, "패션잡화": 0.25, "화장품소매": 0.2, "인터넷쇼핑": 0.08, "악기/공예": 0.05, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 22, "preferences": {"미용서비스": 0.4, "교통서비스": 0.35, "여행": 0.2, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 8, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 3, "preferences": {"예체능계학원": 0.4, "외국어학원": 0.35, "기술/직업교육학원": 0.2, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.8, "기타결제": 0.2}}
                },
                "budget_multiplier": 1.3,
                "monthly_budget": 450
            },
            
            "요가_강사": {
                "age_range": (25, 45),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"한식": 0.35, "카페/디저트": 0.25, "양식": 0.2, "베이커리": 0.15, "일식": 0.03, "중식": 0.02}},
                    "여가/오락": {"frequency": 35, "preferences": {"요가/단전/마사지": 0.6, "일반스포츠": 0.2, "취미/오락": 0.15, "숙박": 0.05}},
                    "소매/유통": {"frequency": 20, "preferences": {"스포츠/레져용품": 0.4, "화장품소매": 0.25, "의복/의류": 0.2, "건강/기호식품": 0.1, "인터넷쇼핑": 0.03, "악기/공예": 0.02}},
                    "생활서비스": {"frequency": 18, "preferences": {"미용서비스": 0.4, "교통서비스": 0.3, "사우나": 0.15, "여행": 0.1, "차량관리/서비스": 0.03, "휴게시설": 0.02}},
                    "학문/교육": {"frequency": 8, "preferences": {"예체능계학원": 0.6, "기술/직업교육학원": 0.2, "외국어학원": 0.15, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "미디어/통신": {"frequency": 5, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.9,
                "monthly_budget": 250
            },
            
            "간호사": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 50, "preferences": {"한식": 0.3, "카페/디저트": 0.25, "중식": 0.2, "양식": 0.15, "베이커리": 0.1}},
                    "소매/유통": {"frequency": 18, "preferences": {"화장품소매": 0.3, "의복/의류": 0.25, "인터넷쇼핑": 0.2, "건강/기호식품": 0.15, "음/식료품소매": 0.05, "패션잡화": 0.03, "종합소매점": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"교통서비스": 0.4, "미용서비스": 0.3, "사우나": 0.15, "여행": 0.1, "차량관리/서비스": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.4, "요가/단전/마사지": 0.3, "숙박": 0.25, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 3, "preferences": {"공연관람": 0.5, "전시장": 0.3, "경기관람": 0.2}},
                    "학문/교육": {"frequency": 4, "preferences": {"기술/직업교육학원": 0.4, "외국어학원": 0.3, "서적/도서": 0.2, "예체능계학원": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 300
            },
            
            "카페사장": {
                "age_range": (25, 50),
                "categories": {
                    "음식": {"frequency": 55, "preferences": {"카페/디저트": 0.4, "베이커리": 0.25, "한식": 0.2, "양식": 0.1, "중식": 0.03, "일식": 0.02}},
                    "소매/유통": {"frequency": 20, "preferences": {"음/식료품소매": 0.4, "종합소매점": 0.2, "의복/의류": 0.15, "인터넷쇼핑": 0.15, "화장품소매": 0.05, "인테리어/가정용품": 0.03, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 18, "preferences": {"교통서비스": 0.4, "미용서비스": 0.25, "차량관리/서비스": 0.2, "여행": 0.1, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 12, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 5, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 2, "preferences": {"기술/직업교육학원": 0.5, "외국어학원": 0.3, "서적/도서": 0.15, "예체능계학원": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 10, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.9,
                "monthly_budget": 250
            },
            
            "교사": {
                "age_range": (24, 50),
                "categories": {
                    "음식": {"frequency": 45, "preferences": {"한식": 0.3, "카페/디저트": 0.25, "양식": 0.2, "베이커리": 0.15, "중식": 0.05, "일식": 0.05}},
                    "소매/유통": {"frequency": 22, "preferences": {"서적/도서": 0.25, "의복/의류": 0.2, "인터넷쇼핑": 0.15, "화장품소매": 0.15, "사무/교육용품": 0.1, "음/식료품소매": 0.08, "건강/기호식품": 0.05, "인테리어/가정용품": 0.02}},
                    "생활서비스": {"frequency": 18, "preferences": {"교통서비스": 0.4, "미용서비스": 0.25, "여행": 0.2, "차량관리/서비스": 0.1, "사우나": 0.03, "휴게시설": 0.02}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.4, "숙박": 0.3, "요가/단전/마사지": 0.2, "일반스포츠": 0.1}},
                    "학문/교육": {"frequency": 12, "preferences": {"서적/도서": 0.3, "기술/직업교육학원": 0.25, "외국어학원": 0.2, "예체능계학원": 0.15, "독서실": 0.05, "입시학원": 0.05}},
                    "공연/전시": {"frequency": 6, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "미디어/통신": {"frequency": 8, "preferences": {"인터넷쇼핑": 0.6, "기타결제": 0.4}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 300
            },
            
            "백화점_직원": {
                "age_range": (22, 40),
                "categories": {
                    "음식": {"frequency": 42, "preferences": {"카페/디저트": 0.3, "양식": 0.25, "한식": 0.2, "베이커리": 0.15, "일식": 0.05, "중식": 0.05}},
                    "소매/유통": {"frequency": 40, "preferences": {"의복/의류": 0.3, "화장품소매": 0.25, "패션잡화": 0.2, "인터넷쇼핑": 0.1, "인테리어/가정용품": 0.08, "악기/공예": 0.05, "건강/기호식품": 0.02}},
                    "생활서비스": {"frequency": 20, "preferences": {"미용서비스": 0.4, "교통서비스": 0.35, "여행": 0.2, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 15, "preferences": {"취미/오락": 0.5, "숙박": 0.3, "요가/단전/마사지": 0.15, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 6, "preferences": {"공연관람": 0.5, "전시장": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 2, "preferences": {"외국어학원": 0.4, "예체능계학원": 0.3, "기술/직업교육학원": 0.2, "서적/도서": 0.05, "독서실": 0.03, "입시학원": 0.02}},
                    "미디어/통신": {"frequency": 10, "preferences": {"인터넷쇼핑": 0.7, "기타결제": 0.3}}
                },
                "budget_multiplier": 1.0,
                "monthly_budget": 320
            },
            
            "프리랜서_디자이너": {
                "age_range": (23, 42),
                "categories": {
                    "음식": {"frequency": 40, "preferences": {"카페/디저트": 0.4, "양식": 0.25, "베이커리": 0.2, "한식": 0.1, "일식": 0.05}},
                    "소매/유통": {"frequency": 25, "preferences": {"악기/공예": 0.3, "의복/의류": 0.25, "인터넷쇼핑": 0.2, "서적/도서": 0.1, "화장품소매": 0.08, "사무/교육용품": 0.05, "패션잡화": 0.02}},
                    "생활서비스": {"frequency": 15, "preferences": {"교통서비스": 0.5, "미용서비스": 0.3, "여행": 0.15, "차량관리/서비스": 0.03, "사우나": 0.01, "휴게시설": 0.01}},
                    "여가/오락": {"frequency": 18, "preferences": {"취미/오락": 0.6, "숙박": 0.25, "요가/단전/마사지": 0.1, "일반스포츠": 0.05}},
                    "공연/전시": {"frequency": 15, "preferences": {"전시장": 0.5, "공연관람": 0.4, "경기관람": 0.1}},
                    "학문/교육": {"frequency": 8, "preferences": {"예체능계학원": 0.5, "기술/직업교육학원": 0.3, "외국어학원": 0.15, "서적/도서": 0.03, "독서실": 0.01, "입시학원": 0.01}},
                    "미디어/통신": {"frequency": 12, "preferences": {"기타결제": 0.6, "인터넷쇼핑": 0.4}}
                },
                "budget_multiplier": 0.85,
                "monthly_budget": 220
            }
        }
        
        # 시간 패턴
        self.weekday_patterns = {
            0: 0.12, 1: 0.13, 2: 0.14, 3: 0.15, 4: 0.18, 5: 0.16, 6: 0.12
        }
        
        self.hour_patterns = {
            "음식": [0.02, 0.01, 0.01, 0.01, 0.01, 0.02, 0.04, 0.08, 0.06, 0.04, 0.05, 0.08, 
                    0.12, 0.08, 0.05, 0.04, 0.05, 0.06, 0.08, 0.10, 0.08, 0.06, 0.04, 0.03],
            "생활서비스": [0.02, 0.01, 0.01, 0.01, 0.02, 0.04, 0.08, 0.12, 0.10, 0.08, 0.06, 0.05,
                    0.06, 0.05, 0.04, 0.04, 0.05, 0.08, 0.10, 0.08, 0.06, 0.04, 0.03, 0.02],
            "default": [0.02, 0.01, 0.01, 0.01, 0.01, 0.02, 0.03, 0.05, 0.06, 0.08, 0.10, 0.08,
                       0.08, 0.07, 0.06, 0.06, 0.07, 0.08, 0.09, 0.08, 0.06, 0.05, 0.04, 0.03]
        }

    def select_persona_by_gender(self, gender: str) -> Tuple[str, Dict]:
        """성별에 따라 페르소나를 랜덤 선택 (나이 무시)"""
        if gender == "남자":
            personas_pool = self.male_personas
        elif gender == "여자":
            personas_pool = self.female_personas
        else:
            # 기본값으로 남성 페르소나 사용
            personas_pool = self.male_personas
        
        # 모든 페르소나에서 랜덤 선택
        selected_persona_name, selected_persona_data = random.choice(list(personas_pool.items()))
        
        # 개인차를 위한 약간의 변형 (20% 확률로 다른 페르소나와 혼합)
        if random.random() < 0.2 and len(personas_pool) > 1:
            # 다른 페르소나와 혼합
            other_personas = [p for p in personas_pool.items() if p[0] != selected_persona_name]
            if other_personas:
                mix_persona_name, mix_persona_data = random.choice(other_personas)
                mixed_data = self.create_mixed_persona(selected_persona_data, mix_persona_data, random.uniform(0.7, 0.9))
                return f"{selected_persona_name}+{mix_persona_name}", mixed_data
        
        return selected_persona_name, selected_persona_data.copy()

    def generate_unique_payment_id(self) -> str:
        """고유한 결제번호 생성"""
        while True:
            payment_id = str(uuid.uuid4())[:8].upper()
            if payment_id not in self.used_payment_ids:
                self.used_payment_ids.add(payment_id)
                return payment_id

    def create_mixed_persona(self, persona1: Dict, persona2: Dict, weight1: float = 0.7) -> Dict:
        """두 페르소나를 섞어서 새로운 패턴 생성"""
        mixed_persona = {"categories": {}, "budget_multiplier": 0, "monthly_budget": 0}
        
        # 카테고리별 빈도와 선호도 혼합
        all_categories = set(persona1["categories"].keys()) | set(persona2.get("categories", {}).keys())
        
        for category in all_categories:
            if category in persona1["categories"] and category in persona2.get("categories", {}):
                freq1 = persona1["categories"][category]["frequency"]
                freq2 = persona2["categories"][category]["frequency"]
                mixed_freq = int(freq1 * weight1 + freq2 * (1 - weight1))
                
                # 선호도 혼합
                pref1 = persona1["categories"][category]["preferences"]
                pref2 = persona2["categories"][category]["preferences"]
                mixed_prefs = {}
                
                all_subcats = set(pref1.keys()) | set(pref2.keys())
                for subcat in all_subcats:
                    val1 = pref1.get(subcat, 0)
                    val2 = pref2.get(subcat, 0)
                    mixed_prefs[subcat] = val1 * weight1 + val2 * (1 - weight1)
                
                # 정규화
                total = sum(mixed_prefs.values())
                if total > 0:
                    mixed_prefs = {k: v/total for k, v in mixed_prefs.items()}
                
                mixed_persona["categories"][category] = {
                    "frequency": mixed_freq,
                    "preferences": mixed_prefs
                }
            elif category in persona1["categories"]:
                mixed_persona["categories"][category] = persona1["categories"][category].copy()
            else:
                mixed_persona["categories"][category] = persona2["categories"][category].copy()
        
        # 예산 혼합
        mixed_persona["budget_multiplier"] = persona1["budget_multiplier"] * weight1 + persona2["budget_multiplier"] * (1 - weight1)
        mixed_persona["monthly_budget"] = int(persona1["monthly_budget"] * weight1 + persona2["monthly_budget"] * (1 - weight1))
        
        return mixed_persona

    def generate_payment_amount(self, category: str, subcategory: str, persona_data: Dict) -> int:
        """페르소나 기반 현실적인 결제 금액 생성"""
        if category not in self.base_categories or subcategory not in self.base_categories[category]:
            return 10000  # 기본값
        
        base_data = self.base_categories[category][subcategory]
        budget_multiplier = persona_data["budget_multiplier"]
        
        # 페르소나 예산에 따른 조정
        adjusted_avg = int(base_data["avg"] * budget_multiplier)
        adjusted_min = max(base_data["min"], int(base_data["min"] * budget_multiplier * 0.8))
        adjusted_max = min(base_data["max"], int(base_data["max"] * budget_multiplier * 1.2))
        
        # 정규분포로 금액 생성
        std = (adjusted_max - adjusted_min) / 6
        amount = np.random.normal(adjusted_avg, std)
        amount = max(adjusted_min, min(adjusted_max, amount))
        
        return int(round(amount / 100) * 100)

    def get_weighted_datetime(self, start_date: datetime, end_date: datetime, category: str) -> datetime:
        """요일과 시간대 패턴을 반영한 결제 시점 생성"""
        days_diff = (end_date - start_date).days
        weights = []
        dates = []
        
        current_date = start_date
        while current_date <= end_date:
            weekday = current_date.weekday()
            weight = self.weekday_patterns[weekday]
            weights.append(weight)
            dates.append(current_date)
            current_date += timedelta(days=1)
        
        selected_date = random.choices(dates, weights=weights)[0]
        
        hour_pattern = self.hour_patterns.get(category, self.hour_patterns["default"])
        selected_hour = random.choices(range(24), weights=hour_pattern)[0]
        selected_minute = random.randint(0, 59)
        selected_second = random.randint(0, 59)
        
        return selected_date.replace(hour=selected_hour, minute=selected_minute, second=selected_second)

    def generate_100_users_dataset(self, end_date: datetime = None, months: int = 3) -> List[PaymentData]:
        """100명의 사용자(남자 50명, 여자 50명)에 대해 각각 90건의 결제 데이터 생성"""
        if end_date is None:
            end_date = datetime.now()
        
        all_payments = []
        
        # 남자 50명 생성
        for user_id in range(1, 51):
            age = random.randint(20, 50)  # 20-50세 랜덤
            user_profile = UserProfile(age=age, gender="남자")
            
            # 3개월치 데이터 생성 (월별 30개씩 = 총 90개)
            user_payments = self.generate_user_payments(user_profile, user_id, months=months, end_date=end_date)
            all_payments.extend(user_payments)
            
            print(f"남자 사용자 {user_id}번 생성 완료: {len(user_payments)}건")
        
        # 여자 50명 생성
        for user_id in range(51, 101):
            age = random.randint(20, 50)  # 20-50세 랜덤
            user_profile = UserProfile(age=age, gender="여자")
            
            # 3개월치 데이터 생성 (월별 30개씩 = 총 90개)
            user_payments = self.generate_user_payments(user_profile, user_id, months=months, end_date=end_date)
            all_payments.extend(user_payments)
            
            print(f"여자 사용자 {user_id}번 생성 완료: {len(user_payments)}건")
        
        print(f"\n전체 데이터 생성 완료: {len(all_payments)}건")
        print(f"남자 사용자: 50명, 여자 사용자: 50명")
        print(f"사용자당 평균 결제 건수: {len(all_payments) // 100}건")
        
        return sorted(all_payments, key=lambda x: (x.유저아이디, x.결제시점))

    def generate_user_payments(self, user_profile: UserProfile, user_id: int, months: int = 3, end_date: datetime = None) -> List[PaymentData]:
        """특정 사용자 프로필에 기반한 결제 데이터 생성 (월별 30개 고정, end_date부터 역순으로 N개월)"""
        
        if end_date is None:
            end_date = datetime.now()
        
        # 성별에 따라 페르소나 선택 (나이 무시)
        persona_name, persona_data = self.select_persona_by_gender(user_profile.gender)
        
        all_payments = []
        
        # end_date부터 역순으로 N개월 계산
        for month_offset in range(months):
            # end_date에서 month_offset개월 전 계산
            target_month = end_date.month - month_offset
            target_year = end_date.year
            
            while target_month <= 0:
                target_month += 12
                target_year -= 1
            
            # 해당 월의 시작일과 종료일
            month_start = datetime(target_year, target_month, 1)
            if target_month == 12:
                month_end = datetime(target_year + 1, 1, 1) - timedelta(days=1)
            else:
                month_end = datetime(target_year, target_month + 1, 1) - timedelta(days=1)
            
            # 현재 월이면 end_date까지만
            if month_offset == 0:
                month_end = min(month_end, end_date)
            
            # 월별 정확히 30개 결제 생성
            monthly_payments = self.generate_fixed_monthly_payments(
                persona_data, month_start, month_end, 30, user_id
            )
            
            all_payments.extend(monthly_payments)
        
        return sorted(all_payments, key=lambda x: x.결제시점)

    def generate_fixed_monthly_payments(self, persona_data: Dict, month_start: datetime, month_end: datetime, payment_count: int = 100, user_id: int = 1) -> List[PaymentData]:
        """한 달에 정확히 지정된 개수의 결제 데이터를 균등 분배하여 생성"""
        monthly_payments = []
        
        # 페르소나의 카테고리별 가중치 계산
        category_weights = {}
        total_frequency = 0
        for category, category_data in persona_data["categories"].items():
            if category in self.base_categories:
                frequency = category_data["frequency"]
                category_weights[category] = frequency
                total_frequency += frequency
        
        # 가중치를 비율로 변환
        category_ratios = {cat: weight / total_frequency for cat, weight in category_weights.items()}
        
        # 각 카테고리별 결제 개수 배분
        assigned_counts = {}
        remaining_count = payment_count
        
        for category, ratio in category_ratios.items():
            count = max(1, int(payment_count * ratio))  # 최소 1개씩은 보장
            assigned_counts[category] = count
            remaining_count -= count
        
        # 남은 개수를 비율대로 추가 분배
        while remaining_count > 0:
            for category in sorted(category_ratios.keys(), key=lambda x: category_ratios[x], reverse=True):
                if remaining_count > 0:
                    assigned_counts[category] += 1
                    remaining_count -= 1
        
        # 실제 결제 데이터 생성
        for category, count in assigned_counts.items():
            category_data = persona_data["categories"][category]
            preferences = category_data["preferences"]
            
            # 실제 존재하는 소분류만 필터링
            valid_subcategories = []
            valid_weights = []
            for subcat, weight in preferences.items():
                if subcat in self.base_categories[category]:
                    valid_subcategories.append(subcat)
                    valid_weights.append(weight)
            
            if not valid_subcategories:
                continue
            
            # 해당 카테고리의 결제들을 생성
            for _ in range(count):
                selected_subcategory = random.choices(valid_subcategories, weights=valid_weights)[0]
                
                # 날짜를 균등하게 분배 (특정 날에 몰리지 않도록)
                payment_datetime = self.get_evenly_distributed_datetime(month_start, month_end, category)
                
                payment = PaymentData(
                    유저아이디=user_id,
                    결제시점=payment_datetime.strftime("%Y-%m-%d %H:%M:%S"),
                    대분류=category,
                    소분류=selected_subcategory,
                    결제번호=self.generate_unique_payment_id(),
                    결제금액=self.generate_payment_amount(category, selected_subcategory, persona_data)
                )
                monthly_payments.append(payment)
        
        return monthly_payments

    def get_evenly_distributed_datetime(self, start_date: datetime, end_date: datetime, category: str) -> datetime:
        """날짜를 균등하게 분배하여 반환 (특정 날에 몰리지 않도록)"""
        # 전체 일수 계산
        total_days = (end_date - start_date).days + 1
        
        # 랜덤한 날짜 선택 (균등 분포)
        random_day_offset = random.randint(0, total_days - 1)
        selected_date = start_date + timedelta(days=random_day_offset)
        
        # 시간대는 카테고리별 패턴 적용
        hour_pattern = self.hour_patterns.get(category, self.hour_patterns["default"])
        selected_hour = random.choices(range(24), weights=hour_pattern)[0]
        selected_minute = random.randint(0, 59)
        selected_second = random.randint(0, 59)
        
        return selected_date.replace(hour=selected_hour, minute=selected_minute, second=selected_second)

    def display_all_payments(self, payments: List[PaymentData], title: str = "전체 결제 내역"):
        """모든 결제 데이터를 보기 좋게 출력"""
        if not payments:
            print(f"\n{title}: 데이터가 없습니다.")
            return
        
        print(f"\n{'='*80}")
        print(f"{title} (총 {len(payments)}건)")
        print(f"{'='*80}")
        print(f"{'번호':<4} {'유저ID':<8} {'결제시점':<20} {'대분류':<12} {'소분류':<18} {'결제금액':<12}")
        print("-" * 80)
        
        total_amount = 0
        for i, payment in enumerate(payments, 1):
            total_amount += payment.결제금액
            print(f"{i:<4} {payment.유저아이디:<8} {payment.결제시점:<20} {payment.대분류:<12} {payment.소분류:<18} {payment.결제금액:>10,}원")
        
        print("-" * 80)
        print(f"총 결제금액: {total_amount:,}원")
        print(f"평균 결제금액: {total_amount//len(payments):,}원")
        
        # 월별 집계
        monthly_stats = {}
        for payment in payments:
            month_key = payment.결제시점[:7]  # YYYY-MM 형태
            if month_key not in monthly_stats:
                monthly_stats[month_key] = {"count": 0, "amount": 0}
            monthly_stats[month_key]["count"] += 1
            monthly_stats[month_key]["amount"] += payment.결제금액
        
        print(f"\n{'월별 집계':<15} {'건수':<8} {'금액'}")
        print("-" * 35)
        for month, stats in sorted(monthly_stats.items()):
            print(f"{month:<15} {stats['count']:<8} {stats['amount']:>12,}원")

    def save_to_csv(self, payments: List[PaymentData], filename: str = None) -> str:
        """결제 데이터를 CSV 파일로 저장"""
        if not payments:
            print("저장할 데이터가 없습니다.")
            return None
        
        if filename is None:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"payment_data_{timestamp}.csv"
        
        # 파일 경로 생성
        current_dir = os.path.dirname(os.path.abspath(__file__))
        filepath = os.path.join(current_dir, filename)
        
        try:
            with open(filepath, 'w', newline='', encoding='utf-8-sig') as csvfile:
                fieldnames = ['유저아이디', '결제시점', '대분류', '소분류', '결제번호', '결제금액']
                writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
                
                # 헤더 작성
                writer.writeheader()
                
                # 데이터 작성
                for payment in payments:
                    writer.writerow({
                        '유저아이디': payment.유저아이디,
                        '결제시점': payment.결제시점,
                        '대분류': payment.대분류,
                        '소분류': payment.소분류,
                        '결제번호': payment.결제번호,
                        '결제금액': payment.결제금액
                    })
            
            print(f"\nCSV 파일이 성공적으로 저장되었습니다: {filepath}")
            print(f"총 {len(payments)}건의 데이터가 저장되었습니다.")
            return filepath
            
        except Exception as e:
            print(f"CSV 파일 저장 중 오류 발생: {e}")
            return None

# 사용 예시 및 테스트
if __name__ == "__main__":
    generator = GenderBasedPaymentGenerator()
    
    print("100명 사용자 결제 데이터 생성기 (남자 50명, 여자 50명)")
    print("=" * 60)
    
    # 2024년 10월 15일 기준으로 6개월치 데이터 생성
    end_date = datetime(2025, 9, 26)
    
    # 100명의 사용자 데이터 생성 (각각 90건씩)
    print("데이터 생성 시작...")
    all_payments = generator.generate_100_users_dataset(end_date=end_date, months=6)
    
    # 통계 출력
    print(f"\n{'='*60}")
    print("생성된 데이터 통계")
    print(f"{'='*60}")
    
    # 성별별 통계
    male_count = len([p for p in all_payments if p.유저아이디 <= 50])
    female_count = len([p for p in all_payments if p.유저아이디 > 50])
    
    print(f"남자 사용자 결제 건수: {male_count}건")
    print(f"여자 사용자 결제 건수: {female_count}건")
    print(f"총 결제 건수: {len(all_payments)}건")
    
    # 카테고리별 통계
    category_stats = {}
    for payment in all_payments:
        if payment.대분류 not in category_stats:
            category_stats[payment.대분류] = 0
        category_stats[payment.대분류] += 1
    
    print(f"\n카테고리별 결제 건수:")
    for category, count in sorted(category_stats.items(), key=lambda x: x[1], reverse=True):
        print(f"  {category}: {count}건")
    
    # CSV 파일로 저장
    print(f"\n{'='*60}")
    print("CSV 파일 저장 중...")
    csv_filepath = generator.save_to_csv(all_payments, "trainset.csv")
    
    if csv_filepath:
        print(f"✅ trainset.csv 파일이 성공적으로 생성되었습니다!")
        print(f"📁 파일 위치: {csv_filepath}")
        print(f"📊 총 데이터: {len(all_payments)}건")
        print(f"👥 사용자 수: 100명 (남자 50명, 여자 50명)")
        print(f"💳 사용자당 평균 결제: {len(all_payments) // 100}건")
    
    # 샘플 데이터 출력 (처음 5개)
    print(f"\n{'='*60}")
    print("샘플 데이터 (처음 5개):")
    print(f"{'='*60}")
    print(f"{'유저ID':<8} {'결제시점':<20} {'대분류':<12} {'소분류':<18} {'결제금액':<12}")
    print("-" * 80)
    for payment in all_payments[:5]:
        print(f"{payment.유저아이디:<8} {payment.결제시점:<20} {payment.대분류:<12} {payment.소분류:<18} {payment.결제금액:>10,}원")